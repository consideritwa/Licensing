function modalOption1Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption1Callback&&modalOption1Callback(t)}function modalOption2Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption2Callback&&modalOption2Callback(t)}function modalOption3Click(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalOption3Callback&&modalOption3Callback(t)}function modalListItemClick(t){document.getElementById("modal").style.display="none",modalVisible=!1,modalListItemCallback&&modalListItemCallback(t)}function modalInputKeyUpEvent(t){if("Enter"===t.key){const e=document.getElementById("modal-button1");if(!e||"none"===e.style.display)return;t.preventDefault(),e.click()}else if("Escape"===t.key||"Esc"===t.key){const e=document.getElementById("modal-button3");if(!e||"none"===e.style.display)return;t.preventDefault(),e.click()}}function setupModal(){const t=document.createElement("div");t.id="modal",document.body.appendChild(t);const e=document.createElement("div");e.id="modal-content",t.appendChild(e);const n=document.createElement("p");n.id="modal-text",e.appendChild(n);const o=document.createElement("input");o.id="modal-input",o.type="text",e.appendChild(o),o.addEventListener("keyup",modalInputKeyUpEvent);const i=document.createElement("label");i.id="modal-colour-label",i.for="modal-colour",e.appendChild(i);const l=document.createElement("input");l.type="color",l.id="modal-colour",e.appendChild(l);const a=document.createElement("fieldset");a.id="modal-list",e.appendChild(a);const d=document.createElement("div");d.id="modal-buttons",e.appendChild(d);const c=document.createElement("button");c.id="modal-button1",c.type="button",c.textContent="ERROR",c.addEventListener("click",modalOption1Click),d.appendChild(c);const s=document.createElement("button");s.id="modal-button2",s.type="button",s.textContent="ERROR",s.addEventListener("click",modalOption2Click),d.appendChild(s);const m=document.createElement("button");m.id="modal-button3",m.type="button",m.textContent="ERROR",m.addEventListener("click",modalOption3Click),d.appendChild(m)}function registerServiceWorker(){navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("controllerchange",function(){window.location.reload()}),navigator.serviceWorker.register("sw.min.js"))}function defaultSettings(){Settings.Highlight1="#CCCC00",Settings.Highlight2="#AA00CC",Settings.Highlight3="#00CCBB",Settings.Highlight4="#222222",Settings.Menu="Open",Settings.Theme="System",Settings.Zoom="Fit"}function loadSettings(){defaultSettings();const t=localStorage.getItem(StoreName.Settings);if(t){const e=JSON.parse(t);e&&(e.Filters&&(e.Filters.Brightness&&(Settings.Filters.Brightness=e.Filters.Brightness),e.Filters.Contrast&&(Settings.Filters.Contrast=e.Filters.Contrast),e.Filters.Hue&&(Settings.Filters.Hue=e.Filters.Hue),e.Filters.Saturation&&(Settings.Filters.Saturation=e.Filters.Saturation)),e.Highlight1&&(Settings.Highlight1=e.Highlight1),e.Highlight2&&(Settings.Highlight2=e.Highlight2),e.Highlight3&&(Settings.Highlight3=e.Highlight3),e.Highlight4&&(Settings.Highlight4=e.Highlight4),e.Menu&&(Settings.Menu=e.Menu),e.Theme&&(Settings.Theme=e.Theme),e.Zoom&&(Settings.Zoom=e.Zoom))}}function saveSettings(){const t=JSON.stringify(Settings);localStorage.setItem(StoreName.Settings,t)}function setTheme(t){switch(t){case"Light":document.documentElement.className="theme-light";break;case"Dark":document.documentElement.className="theme-dark";break;case"System":default:document.documentElement.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-light"}}function themeChange(t){if("System"===Settings.Theme){const e=document.getElementsByTagName("html")[0];e.className=t.matches?"theme-dark":"theme-light"}}function addThemeListener(t){const e=window.matchMedia("(prefers-color-scheme: dark)");"addEventListener"in e&&e.addEventListener("change",t)}function downloadBlob(t,e){const n=document.createElement("a");n.rel="noopener",n.download=t,n.href=URL.createObjectURL(e),setTimeout(function(){URL.revokeObjectURL(n.href)},45e3),n.click()}function exportPng(t,e,n){const o=document.createElement("canvas"),i=o.getContext("2d"),l=new Image;l.onload=function(){o.width=l.width,o.height=l.height,n&&(i.fillStyle=n,i.rect(0,0,o.width,o.height),i.fill()),"imageSmoothingQuality"in i&&(i.imageSmoothingQuality="high"),i.drawImage(l,0,0),o.toBlob(function(e){downloadBlob(t,e)})},l.src="data:image/svg+xml;base64,"+btoa(e)}function exportSvg(t,e){const n=new Blob([e],{type:"image/svg+xml"});downloadBlob(t,n)}function createElementFromHtml(t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild}function getStringBetween(t,e,n,o){if(!t)return;if(-1===e)return;const i=t.indexOf(n,e);if(-1===i)return;const l=t.indexOf(o,i);return-1!==l?t.substring(i+1,l):void 0}function getFiltersCss(t,e,n,o){const i=(t/10).toFixed(1),l=(e/10).toFixed(1),a=n+"deg",d=(o/10).toFixed(1);return`brightness(${i}) contrast(${l}) hue-rotate(${a}) saturate(${d})`}function backOrHome(){window.history.length<=1||""===document.referrer?window.location.href="/":window.history.back()}function showModalDialog(t="ERROR",e=!1,n="",o="",i,l="",a,d="",c,s=!1,m=[],r,u=!1,g="",h){modalOption1Callback=i,modalOption2Callback=a,modalOption3Callback=c,modalListItemCallback=r,document.getElementById("modal-text").innerHTML=t;const p=document.getElementById("modal-input");p.value=n,p.style.display=e?"inline-block":"none";const y=document.getElementById("modal-list");for(;y.lastChild;)y.removeChild(y.lastChild);if(s){const t=32,e=27;for(const n of m){const o=document.createElement("button");o.value=n.value,o.textContent=n.label;let i=n.value;const l=new RegExp("(.*)\\(([0-9]+)x([0-9]+)\\)"),a=l.exec(i);if(0!==a.length){i=a[1];let n=a[2],l=a[3];if((n>t||l>t)&&(scale=Math.min(t/n,t/l),n*=scale,l*=scale),o.style.backgroundSize=`${n}px ${l}px`,n<t){const i=e-(t-n)/2;o.style.backgroundPositionX=`${i}px`}}o.style.backgroundImage=`url(${i})`,y.appendChild(o),o.addEventListener("click",modalListItemClick)}}y.style.display=s?"grid":"none";const f=document.getElementById("modal-colour-label"),b=document.getElementById("modal-colour");u&&(f.textContent=g,b.value=h||Colours[0]),f.style.display=u?"inline-block":"none",b.style.display=u?"inline-block":"none";const C=document.getElementById("modal-button1");C.textContent=o,C.style.display=o?"inline-block":"none";const k=document.getElementById("modal-button2");k.textContent=l,k.style.display=l?"inline-block":"none";const E=document.getElementById("modal-button3");E.textContent=d,E.style.display=d?"inline-block":"none",document.getElementById("modal").style.display="block",modalVisible=!0,e||!o||l||d||C.focus(),e&&p.focus()}function getModalInputText(){return document.getElementById("modal-input").value}function getModalColourValue(){return document.getElementById("modal-colour").value}function getHexForColour(t){const e=document.createElement("canvas").getContext("2d");return e.fillStyle=t,e.fillStyle}function isEmbedded(){try{return window.self!==window.top}catch{return!0}}const StoreName={Flags:"flags",Settings:"settings",MatrixSelection:"matrix-selection"},Mouse={Button:{Left:0,Middle:1,Right:2,Back:3,Forward:4},Buttons:{Left:1,Right:2,Middle:4,Back:8,Forward:16},Which:{Left:1,Middle:2,Right:3}},Settings={Filters:{Brightness:10,Contrast:10,Hue:0,Saturation:10},Highlight1:"",Highlight2:"",Highlight3:"",Highlight4:"",Menu:"",Theme:"",Zoom:""},isIOS=window.navigator.userAgent.includes("iPad")||window.navigator.userAgent.includes("iPhone");let modalVisible=!1,modalOption1Callback=void 0,modalOption2Callback=void 0,modalOption3Callback=void 0,modalListItemCallback=void 0;registerServiceWorker(),loadSettings(),setTheme(Settings.Theme),addThemeListener(themeChange);
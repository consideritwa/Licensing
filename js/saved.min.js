function newDivider(){const e=document.createElement("div");return e.className="divider",e}function newDiagramLink(e,t){const n=document.createElement("a");return n.className="diagram",n.textContent=e,n.href=t,n}function newPngButton(){const e=document.createElement("button");return e.type="button",e.className="export",e.title="Export PNG",e.textContent="PNG",e}function newSvgButton(){const e=document.createElement("button");return e.type="button",e.className="export",e.title="Export SVG",e.textContent="SVG",e}function newDeleteButton(){const e=document.createElement("button");return e.type="button",e.className="delete",e.title="Delete",e}function newRenameButton(){const e=document.createElement("button");return e.type="button",e.className="rename",e.title="Rename",e}function addEmptyMessage(e){const t=document.createElement("p");t.innerText="There are no saved diagrams.",e.appendChild(t)}function addNewRow(e,t,n){const o=newDiagramLink(n.Title,`/viewsvg.htm#*${t}`);e.appendChild(o);const l=newRenameButton();e.appendChild(l);const i=newDeleteButton();e.appendChild(i);const d=newSvgButton();e.appendChild(d);const a=newPngButton();e.appendChild(a);const r=newDivider();e.appendChild(r),l.addEventListener("click",function(){showModalDialog("Rename saved diagram:",!0,o.textContent,"OK",function(){const e=getModalInputText();if(!e)return;n.Title=e;const l=JSON.stringify(n);localStorage.setItem(t,l),o.textContent=e},void 0,void 0,"Cancel",void 0)}),i.addEventListener("click",function(){showModalDialog(`Are you sure you want to delete "${o.textContent}"?`,!1,void 0,"Yes",function(){localStorage.removeItem(t),e.removeChild(o),e.removeChild(l),e.removeChild(i),e.removeChild(d),e.removeChild(a),e.removeChild(r),0===e.getElementsByClassName("diagram").length&&(e.innerHTML="",e.appendChild(newDivider()),addEmptyMessage(e),e.appendChild(newDivider()))},void 0,void 0,"No",void 0)}),d.addEventListener("click",function(e){e.preventDefault(),exportSvg(n.Title+".svg",n.SvgXml)}),a.addEventListener("click",function(){const e=window.getComputedStyle(document.body).backgroundColor;exportPng(n.Title+".png",n.SvgXml,e)})}function populateList(){const e=document.getElementById("collection");e.innerHTML="",e.appendChild(newDivider());let t=[];for(let e=0;e<localStorage.length;e+=1){const n=localStorage.key(e);n!==StoreName.Flags&&n!==StoreName.Settings&&n!==StoreName.MatrixSelection&&t.push(n)}t=t.sort(function(e,t){return parseInt(e)-parseInt(t)});for(const n of t){const t=localStorage.getItem(n);if(t){const o=JSON.parse(t);o&&addNewRow(e,n,o)}}0===t.length&&(addEmptyMessage(e),e.appendChild(newDivider()))}function processImport(e,t){const n=e[t],o=new FileReader;o.addEventListener("load",function(o){showModalDialog(0===e.length?"Import diagram as:":`Import diagram ${t+1} of ${e.length} as:`,!0,n.name,"OK",function(){const n=getModalInputText();if(!n)return;const l=Date.now().toString(),i={Title:n,SvgXml:o.target.result},d=JSON.stringify(i);localStorage.setItem(l,d),populateList(),t!==e.length-1&&(t++,processImport(e,t))},void 0,void 0,1===e.length?"Cancel":"Skip",function(){t!==e.length-1&&processImport(e,++t)})}),o.readAsText(n)}function filesSelected(e){processImport(e.target.files,0)}function exportAllDiagrams(e){const t=document.getElementsByClassName("export");for(const n of t)n.textContent===e&&n.click()}function DOMContentLoaded(){isEmbedded()&&(document.getElementById("menu").style.display="none"),setupModal(),populateList(),isIOS?document.getElementById("export-all-png").style.display="none":document.getElementById("export-all-png").addEventListener("click",()=>exportAllDiagrams("PNG")),isIOS?document.getElementById("export-all-svg").style.display="none":document.getElementById("export-all-svg").addEventListener("click",()=>exportAllDiagrams("SVG")),document.getElementById("import").addEventListener("click",()=>document.getElementById("file-selector").click()),document.getElementById("file-selector").addEventListener("change",filesSelected)}document.addEventListener("DOMContentLoaded",DOMContentLoaded);